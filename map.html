<!DOCTYPE html>
<html>

<head>
    <title>Google Maps Example</title>
    <style>
        #map {
            height: 100%;
        }

        html,
        body {
            height: 100%;
            margin: 0;
            padding: 0;
        }
    </style>
</head>

<body>
    <div id="map"></div>
    
    <script>
        let formData = new FormData();
        formData.append("PropertySearchForm[location]", "4");
        formData.append("PropertySearchForm[checkinDate]", "27.06.2024");
        formData.append("PropertySearchForm[checkoutDate]", "30.06.2024");
        formData.append("PropertySearchForm[guests]", JSON.stringify([{ "adults": 2 }]));
        formData.append("PropertySearchForm[partner]", "11115");
        formData.append("PropertySearchForm[map]", "true");

        // Функция для получения данных из search-map-points API
        function fetchMarkerData() {
            const apiUrl = 'https://travelhub.by/hotels/search-map-points';
            fetch(apiUrl, {
                method: 'POST',
                body: formData
            }).then(response => {
                const data = response.json()
                return data
            })
            
        }

        markerData = fetchMarkerData()
        console.log(markerData)

        function initMap() {


            var map = new google.maps.Map(document.getElementById('map'), {
                zoom: 10,
                center: { lat: 26.462482, lng: 93.557921 },
                mapId: "4504f8b37365c3d0",
                mapTypeControl: false,
                fullscreenControl: false,
                streetViewControl: false,
                gestureHandling: 'greedy',
            });

            // Получаем данные из первого API
            // fetch('URL_первого_API')
            //     .then(response => response.json())
            //     .then(data => {
            //         data.data.forEach(location => {
            //             var marker = new google.maps.Marker({
            //                 position: { lat: parseFloat(location.lat), lng: parseFloat(location.lng) },
            //                 map: map
            //             });

            //             // Добавляем обработчик кликов на маркер
            //             marker.addListener('click', () => {
            //                 fetch(`URL_второго_API?id=${location.id}`)
            //                     .then(response => response.json())
            //                     .then(details => {
            //                         var infoWindow = new google.maps.InfoWindow({
            //                             content: `
            //                                 <div>
            //                                     <p>Цена: ${details.price} ${data.currency}</p>
            //                                     <p>ID: ${details.id}</p>
            //                                     <p>Доп. информация: ${details.additionalInfo}</p>
            //                                 </div>
            //                             `
            //                         });
            //                         infoWindow.open(map, marker);
            //                     })
            //                     .catch(error => console.error('Ошибка при получении данных второго API:', error));
            //             });
            //         });
            //     })
            //     .catch(error => console.error('Ошибка при получении данных первого API:', error));
        }
    </script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCCb1g3WbPwWru2h3wjIoQSUskXbQhrMak&callback=initMap"
        async defer></script>
</body>

</html>