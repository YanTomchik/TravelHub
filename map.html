<html>
  <head>
    <title>Advanced Markers with HTML</title>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=default" async></script>
    <script src="https://use.fontawesome.com/releases/v6.2.0/js/all.js" async></script>

    <!-- <link rel="stylesheet" type="text/css" href="./files/map.css" async/> -->
    <!-- <link rel="stylesheet" type="text/css" href="./files/main.css" async/> -->
    <!-- <script type="module" src="./files/map.js" async></script> -->
  </head>
  <body style="background-color: #f5f5f5;">
    <div id="map-dashoard-wrapper"></div>
    <script>
        async function fetchDataFromAPI(formData) {
            try {
                const response = await fetch('https://travelhub.by/hotels/search-map', {
                    method: 'POST',
                    body: formData
                });
                const data = await response.json();
                return data;
            } catch (error) {
                console.error('Error fetching data from API:', error);
                throw error;
            }
        }

        // Функция для получения кэшированных данных из локального хранилища
        function getCachedData() {
            const cachedData = localStorage.getItem('cachedData');
            if (cachedData) {
                return JSON.parse(cachedData);
            }
            return null;
        }

        // Функция для сохранения данных в локальное хранилище
        function cacheData(data) {
            localStorage.setItem('cachedData', JSON.stringify(data));
        }

        // Функция для получения данных: сначала проверяем кэш, затем загружаем из API
        async function getData() {
            let data = getCachedData();
            if (!data) {
                const formData = new FormData();
                formData.append("PropertySearchForm[location]", "4");
                formData.append("PropertySearchForm[checkinDate]", "27.05.2024");
                formData.append("PropertySearchForm[checkoutDate]", "30.05.2024");
                formData.append("PropertySearchForm[guests]", JSON.stringify([{ "adults": 2 }]));
                formData.append("PropertySearchForm[partner]", "11115");
                formData.append("PropertySearchForm[map]", "true");
                data = await fetchDataFromAPI(formData);
                cacheData(data);
            }
            return data;
        }

        // Пример использования
        async function exampleUsage() {
            try {
                // Получаем данные
                const data = await getData();
                console.log('Data:', data);
            } catch (error) {
                console.error('Error:', error);
            }
        }

        // Запускаем пример использования
        exampleUsage();

    </script>
  </body>
</html>





